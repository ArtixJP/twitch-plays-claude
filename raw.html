<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<title>Reset</title>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #333;
            font-family: system-ui, -apple-system, sans-serif;
            text-align: center;
        }
        h1 { font-size: 2rem; margin-bottom: 10px; }
        p { font-size: 1rem; opacity: 0.7; }
        code { background: #eee; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
<div class="red-triangle" id="redFighter" style="position: fixed; left: 150px; top: 300px; width: 0; height: 0; border-left: 60px solid transparent; border-right: 60px solid transparent; border-bottom: 100px solid #e53935; filter: drop-shadow(0 4px 20px rgba(229, 57, 53, 0.6)); z-index: 10;">
<div class="health-bar" style="position: absolute; top: -20px; left: 0; width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden;">
<div id="redHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s;"></div>
</div>
<span style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%); color: #e53935; font-weight: bold; font-size: 12px;">TRIANGLE</span>
</div>
<div class="blue-square" id="blueFighter" style="position: fixed; left: 550px; top: 310px; width: 80px; height: 80px; background: linear-gradient(135deg, #2196f3, #0d47a1); box-shadow: 0 4px 20px rgba(33, 150, 243, 0.4); border-radius: 8px; z-index: 10;">
<div class="health-bar" style="position: absolute; top: -20px; left: 0; width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden;">
<div id="blueHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s;"></div>
</div>
<span style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%); color: #2196f3; font-weight: bold; font-size: 12px;">SQUARE</span>
</div>
<div class="purple-losange" id="purpleFighter" style="position: fixed; left: 450px; top: 200px; width: 60px; height: 60px; background: linear-gradient(135deg, #9c27b0, #6a1b9a); box-shadow: 0 4px 20px rgba(156, 39, 176, 0.6); z-index: 10; transform: rotate(45deg); animation: losangePulse 1.3s ease-in-out infinite;">
<div class="health-bar" style="position: absolute; top: -30px; left: -10px; width: 80px; height: 12px; background: #333; border-radius: 6px; overflow: hidden; transform: rotate(-45deg);">
<div id="purpleHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s;"></div>
</div>
<span style="position: absolute; top: -45px; left: 50%; transform: translateX(-50%) rotate(-45deg); color: #9c27b0; font-weight: bold; font-size: 12px;">LOSANGE</span>
</div>
<div class="green-rectangle" id="greenFighter" style="position: fixed; left: 250px; top: 200px; width: 70px; height: 45px; background: linear-gradient(135deg, #4caf50, #2e7d32); box-shadow: 0 4px 20px rgba(76, 175, 80, 0.6); border-radius: 6px; z-index: 10; animation: greenPulse 1.4s ease-in-out infinite;">
<div class="health-bar" style="position: absolute; top: -20px; left: 0; width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden;">
<div id="greenHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s;"></div>
</div>
<span style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%); color: #4caf50; font-weight: bold; font-size: 12px;">GREEN</span>
</div>
<div class="yellow-rectangle" id="yellowFighter" style="position: fixed; left: 350px; top: 450px; width: 100px; height: 50px; background: linear-gradient(135deg, #ffeb3b, #ffc107); box-shadow: 0 4px 20px rgba(255, 235, 59, 0.6); border-radius: 6px; z-index: 10; animation: rectPulse 1.5s ease-in-out infinite;">
<div class="health-bar" style="position: absolute; top: -20px; left: 0; width: 100%; height: 12px; background: #333; border-radius: 6px; overflow: hidden;">
<div id="yellowHealth" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.3s;"></div>
</div>
<span style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%); color: #ffc107; font-weight: bold; font-size: 12px;">RECTANGLE</span>
</div>
<div id="battleArena" style="position: fixed; top: 50px; left: 50%; transform: translateX(-50%); text-align: center; z-index: 100;">
<h2 style="color: #ff5722; font-size: 28px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); animation: titlePulse 1s ease-in-out infinite;">‚öîÔ∏è SHAPE WARS ‚öîÔ∏è</h2>
<p id="battleStatus" style="color: #fff; background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 20px; margin-top: 10px;">FIGHT!</p>
<div id="hiMom" style="position: absolute; top: 60px; right: -80px; background: linear-gradient(135deg, #ff69b4, #ff1493); color: white; padding: 8px 15px; border-radius: 15px; font-size: 14px; font-weight: bold; animation: hiMomFloat 2s ease-in-out infinite; box-shadow: 0 4px 15px rgba(255,105,180,0.5);">üëã Hi Mom! üíñ<div style="position: absolute; bottom: -8px; left: 20px; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 10px solid #ff1493;"></div></div>
<div id="hiGrandma" style="position: absolute; top: 60px; left: -100px; background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; padding: 8px 15px; border-radius: 15px; font-size: 14px; font-weight: bold; animation: hiGrandmaFloat 2.5s ease-in-out infinite; box-shadow: 0 4px 15px rgba(156,39,176,0.5);">üëµ Hi Grandma! üíú<div style="position: absolute; bottom: -8px; right: 20px; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 10px solid #7b1fa2;"></div></div>
</div>
<div id="impactEffect" style="position: fixed; width: 100px; height: 100px; pointer-events: none; z-index: 50; display: none;"></div>
<div class="ghost-container">
<h1 class="ghost-text">‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë</h1>
<p class="ghost-text">‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë ‚ñë</p>
</div>
<style>
        .ghost-container {
            position: relative;
        }
        .ghost-text {
            opacity: 0.08;
            color: #999;
            letter-spacing: 0.3em;
            animation: ghostPulse 4s ease-in-out infinite;
            user-select: none;
        }
        @keyframes ghostPulse {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.12; }
        }
        .ghost-container::after {
            content: '...';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0.3;
            animation: ellipsis 2s steps(4) infinite;
        }
        @keyframes triPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.02); opacity: 1; box-shadow: 0 6px 30px rgba(229, 57, 53, 0.6); }
        }
        @keyframes circlePulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; box-shadow: 0 6px 30px rgba(33, 150, 243, 0.6); }
        }
        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); text-shadow: 0 0 20px #ff5722; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            75% { transform: translateX(5px) rotate(2deg); }
        }
        @keyframes impact {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        .hit-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #ffeb3b, #ff9800, transparent);
            border-radius: 50%;
            animation: impact 0.4s ease-out forwards;
        }
        @keyframes hiGrandmaFloat {
            0%, 100% { transform: translateY(0) rotate(2deg); }
            50% { transform: translateY(-10px) rotate(-2deg); }
        }
        @keyframes losangePulse {
            0%, 100% { transform: rotate(45deg) scale(1); opacity: 0.9; }
            50% { transform: rotate(45deg) scale(1.08); opacity: 1; box-shadow: 0 6px 30px rgba(156, 39, 176, 0.7); }
        }
        @keyframes greenPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.06); opacity: 1; box-shadow: 0 6px 30px rgba(76, 175, 80, 0.7); }
        }
        @keyframes rectPulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.04); opacity: 1; box-shadow: 0 6px 30px rgba(255, 235, 59, 0.7); }
        }
        @keyframes hiMomFloat {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        @keyframes ellipsis {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }
    </style>
<script>
(function() {
    const red = document.getElementById('redFighter');
    const blue = document.getElementById('blueFighter');
    const redHealthBar = document.getElementById('redHealth');
    const blueHealthBar = document.getElementById('blueHealth');
    const status = document.getElementById('battleStatus');
    const impact = document.getElementById('impactEffect');
    
    let redHealth = 100;
    let blueHealth = 100;
    let redX = 150, redY = 300;
    let blueX = 550, blueY = 310;
    let redVX = 0, redVY = 0;
    let blueVX = 0, blueVY = 0;
    let yellowX = 350, yellowY = 450;
    let yellowVX = 0, yellowVY = 0;
    let yellowHealth = 100;
    const yellow = document.getElementById('yellowFighter');
    const yellowHealthBar = document.getElementById('yellowHealth');
    let greenX = 250, greenY = 200;
    let greenVX = 0, greenVY = 0;
    let greenHealth = 100;
    const green = document.getElementById('greenFighter');
    const greenHealthBar = document.getElementById('greenHealth');
    let purpleX = 450, purpleY = 200;
    let purpleVX = 0, purpleVY = 0;
    let purpleHealth = 100;
    const purple = document.getElementById('purpleFighter');
    const purpleHealthBar = document.getElementById('purpleHealth');
    let battleOver = false;
    
    const attacks = ['PUNCH!', 'SLAM!', 'BASH!', 'WHACK!', 'POW!', 'BOOM!'];
    
    function showImpact(x, y) {
        const effect = document.createElement('div');
        effect.className = 'hit-effect';
        effect.style.left = (x - 30) + 'px';
        effect.style.top = (y - 30) + 'px';
        effect.style.position = 'fixed';
        effect.style.zIndex = '60';
        document.body.appendChild(effect);
        setTimeout(() => effect.remove(), 400);
    }
    
    function updatePositions() {
        red.style.left = redX + 'px';
        red.style.top = redY + 'px';
        blue.style.left = blueX + 'px';
        blue.style.top = blueY + 'px';
    }
    
    function checkCollision() {
        const dx = (redX + 61) - (blueX + 40);
        const dy = (redY + 49) - (blueY + 40);
        const dist = Math.sqrt(dx*dx + dy*dy);
        return dist < 100;
    }
    
    function fight() {
        if (battleOver) return;
        
        // Move towards each other
        const dx = (blueX + 40) - (redX + 61);
        const dy = (blueY + 40) - (redY + 49);
        const dist = Math.sqrt(dx*dx + dy*dy);
        
        if (dist > 80) {
            redVX = (dx / dist) * 4 + (Math.random() - 0.5) * 2;
            redVY = (dy / dist) * 4 + (Math.random() - 0.5) * 2;
            blueVX = (-dx / dist) * 4 + (Math.random() - 0.5) * 2;
            blueVY = (-dy / dist) * 4 + (Math.random() - 0.5) * 2;
        }
        
        redX += redVX;
        redY += redVY;
        blueX += blueVX;
        blueY += blueVY;
        
        // Boundaries
        redX = Math.max(50, Math.min(700, redX));
        redY = Math.max(150, Math.min(500, redY));
        blueX = Math.max(50, Math.min(700, blueX));
        blueY = Math.max(150, Math.min(500, blueY));
        
        if (checkCollision()) {
            // COLLISION! Both take damage
            const damage = Math.floor(Math.random() * 15) + 5;
            const attacker = Math.random() > 0.5 ? 'red' : 'blue';
            
            if (attacker === 'red') {
                blueHealth -= damage;
                blue.style.animation = 'shake 0.2s';
                status.textContent = 'üî¥ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + damage;
            } else {
                redHealth -= damage;
                red.style.animation = 'shake 0.2s';
                status.textContent = 'üîµ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + damage;
            }
            
            showImpact((redX + blueX) / 2 + 60, (redY + blueY) / 2 + 50);
            
            // Bounce apart
            redVX = -dx / dist * 8;
            redVY = -dy / dist * 8;
            blueVX = dx / dist * 8;
            blueVY = dy / dist * 8;
            
            setTimeout(() => {
                red.style.animation = '';
                blue.style.animation = '';
            }, 200);
            
            // Update health bars
            redHealthBar.style.width = Math.max(0, redHealth) + '%';
            blueHealthBar.style.width = Math.max(0, blueHealth) + '%';
            
            if (redHealth <= 0 || blueHealth <= 0) {
                battleOver = true;
                let winner = 'üü® RECTANGLE';
                const scores = [{name: 'üî∫ TRIANGLE', h: redHealth}, {name: 'üü¶ SQUARE', h: blueHealth}, {name: 'üü® RECTANGLE', h: yellowHealth}, {name: 'üü£ LOSANGE', h: purpleHealth}, {name: 'üü© GREEN', h: greenHealth}];
                winner = scores.sort((a,b) => b.h - a.h)[0].name;
                status.textContent = winner + ' WINS!';
                status.style.background = 'linear-gradient(90deg, gold, orange)';
                status.style.color = '#333';
                status.style.fontWeight = 'bold';
                
                // Loser fades
                if (redHealth <= 0) red.style.opacity = '0.3';
                if (blueHealth <= 0) blue.style.opacity = '0.3';
                
                // Restart after 3 seconds
                setTimeout(() => {
                    redHealth = 100; blueHealth = 100; yellowHealth = 100; purpleHealth = 100; greenHealth = 100;
                    redX = 150; redY = 300;
                    blueX = 550; blueY = 310;
                    redHealthBar.style.width = '100%';
                    blueHealthBar.style.width = '100%';
                    red.style.opacity = '1';
                    yellow.style.opacity = '1';
                    yellowX = 350; yellowY = 450;
                    yellowHealthBar.style.width = '100%';
                    purple.style.opacity = '1';
                    purpleX = 450; purpleY = 200;
                    purpleHealthBar.style.width = '100%';
                    green.style.opacity = '1';
                    greenX = 250; greenY = 200;
                    greenHealthBar.style.width = '100%';
                    blue.style.opacity = '1';
                    status.textContent = 'ROUND 2... FIGHT!';
                    status.style.background = 'rgba(0,0,0,0.7)';
                    status.style.color = '#fff';
                    battleOver = false;
                }, 3000);
            }
        }
        
        // Yellow fighter AI - targets closest enemy
        const dyellowRed = Math.sqrt((redX - yellowX)**2 + (redY - yellowY)**2);
        const dyellowBlue = Math.sqrt((blueX - yellowX)**2 + (blueY - yellowY)**2);
        let targetX, targetY;
        if (dyellowRed < dyellowBlue) {
            targetX = redX + 61; targetY = redY + 49;
        } else {
            targetX = blueX + 40; targetY = blueY + 40;
        }
        const dxY = targetX - (yellowX + 50);
        const dyY = targetY - (yellowY + 25);
        const distY = Math.sqrt(dxY*dxY + dyY*dyY);
        if (distY > 60) {
            yellowVX = (dxY / distY) * 3.5 + (Math.random() - 0.5) * 2;
            yellowVY = (dyY / distY) * 3.5 + (Math.random() - 0.5) * 2;
        }
        yellowX += yellowVX; yellowY += yellowVY;
        yellowX = Math.max(50, Math.min(700, yellowX));
        yellowY = Math.max(150, Math.min(500, yellowY));
        yellow.style.left = yellowX + 'px';
        yellow.style.top = yellowY + 'px';
        
        // Yellow vs Red collision
        const yrDist = Math.sqrt((redX+61 - yellowX-50)**2 + (redY+49 - yellowY-25)**2);
        if (yrDist < 80 && !battleOver) {
            const dmg = Math.floor(Math.random() * 12) + 5;
            if (Math.random() > 0.5) {
                redHealth -= dmg; red.style.animation = 'shake 0.2s';
                status.textContent = 'üü® ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg;
            } else {
                yellowHealth -= dmg; yellow.style.animation = 'shake 0.2s';
                status.textContent = 'üî¥ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg;
            }
            showImpact((redX + yellowX) / 2 + 50, (redY + yellowY) / 2 + 40);
            yellowVX = -(redX - yellowX) / yrDist * 6; yellowVY = -(redY - yellowY) / yrDist * 6;
            setTimeout(() => { yellow.style.animation = ''; red.style.animation = ''; }, 200);
        }
        
        // Yellow vs Blue collision
        const ybDist = Math.sqrt((blueX+40 - yellowX-50)**2 + (blueY+40 - yellowY-25)**2);
        if (ybDist < 80 && !battleOver) {
            const dmg = Math.floor(Math.random() * 12) + 5;
            if (Math.random() > 0.5) {
                blueHealth -= dmg; blue.style.animation = 'shake 0.2s';
                status.textContent = 'üü® ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg;
            } else {
                yellowHealth -= dmg; yellow.style.animation = 'shake 0.2s';
                status.textContent = 'üîµ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg;
            }
            showImpact((blueX + yellowX) / 2 + 50, (blueY + yellowY) / 2 + 40);
            yellowVX = -(blueX - yellowX) / ybDist * 6; yellowVY = -(blueY - yellowY) / ybDist * 6;
            setTimeout(() => { yellow.style.animation = ''; blue.style.animation = ''; }, 200);
        }
        
        redHealthBar.style.width = Math.max(0, redHealth) + '%';
        blueHealthBar.style.width = Math.max(0, blueHealth) + '%';
        yellowHealthBar.style.width = Math.max(0, yellowHealth) + '%';
        purpleHealthBar.style.width = Math.max(0, purpleHealth) + '%';
        
        if (yellowHealth <= 0 && !battleOver) {
            yellow.style.opacity = '0.3';
        }
        if (purpleHealth <= 0 && !battleOver) {
            purple.style.opacity = '0.3';
        }
        
        // Purple losange AI - aggressive, targets weakest enemy
        let pTargetX, pTargetY;
        const healths = [{h: redHealth, x: redX+61, y: redY+49}, {h: blueHealth, x: blueX+40, y: blueY+40}, {h: yellowHealth, x: yellowX+50, y: yellowY+25}, {h: greenHealth, x: greenX+35, y: greenY+22}];
        const weakest = healths.filter(e => e.h > 0).sort((a,b) => a.h - b.h)[0];
        if (weakest) { pTargetX = weakest.x; pTargetY = weakest.y; }
        else { pTargetX = 400; pTargetY = 350; }
        const dxP = pTargetX - (purpleX + 30);
        const dyP = pTargetY - (purpleY + 30);
        const distP = Math.sqrt(dxP*dxP + dyP*dyP);
        if (distP > 50) {
            purpleVX = (dxP / distP) * 4.5 + (Math.random() - 0.5) * 3;
            purpleVY = (dyP / distP) * 4.5 + (Math.random() - 0.5) * 3;
        }
        purpleX += purpleVX; purpleY += purpleVY;
        purpleX = Math.max(50, Math.min(700, purpleX));
        purpleY = Math.max(150, Math.min(500, purpleY));
        purple.style.left = purpleX + 'px';
        purple.style.top = purpleY + 'px';
        
        // Purple collisions with all fighters
        const prDist = Math.sqrt((redX+61 - purpleX-30)**2 + (redY+49 - purpleY-30)**2);
        if (prDist < 70 && !battleOver && redHealth > 0 && purpleHealth > 0) {
            const dmg = Math.floor(Math.random() * 14) + 6;
            if (Math.random() > 0.45) { redHealth -= dmg; red.style.animation = 'shake 0.2s'; status.textContent = 'üü£ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { purpleHealth -= dmg; purple.style.animation = 'shake 0.2s'; status.textContent = 'üî¥ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((redX + purpleX) / 2 + 45, (redY + purpleY) / 2 + 40);
            purpleVX = -(redX - purpleX) / prDist * 7; purpleVY = -(redY - purpleY) / prDist * 7;
            setTimeout(() => { purple.style.animation = 'losangePulse 1.3s ease-in-out infinite'; red.style.animation = ''; }, 200);
        }
        const pbDist = Math.sqrt((blueX+40 - purpleX-30)**2 + (blueY+40 - purpleY-30)**2);
        if (pbDist < 70 && !battleOver && blueHealth > 0 && purpleHealth > 0) {
            const dmg = Math.floor(Math.random() * 14) + 6;
            if (Math.random() > 0.45) { blueHealth -= dmg; blue.style.animation = 'shake 0.2s'; status.textContent = 'üü£ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { purpleHealth -= dmg; purple.style.animation = 'shake 0.2s'; status.textContent = 'üîµ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((blueX + purpleX) / 2 + 35, (blueY + purpleY) / 2 + 35);
            purpleVX = -(blueX - purpleX) / pbDist * 7; purpleVY = -(blueY - purpleY) / pbDist * 7;
            setTimeout(() => { purple.style.animation = 'losangePulse 1.3s ease-in-out infinite'; blue.style.animation = ''; }, 200);
        }
        const pyDist = Math.sqrt((yellowX+50 - purpleX-30)**2 + (yellowY+25 - purpleY-30)**2);
        if (pyDist < 70 && !battleOver && yellowHealth > 0 && purpleHealth > 0) {
            const dmg = Math.floor(Math.random() * 14) + 6;
            if (Math.random() > 0.45) { yellowHealth -= dmg; yellow.style.animation = 'shake 0.2s'; status.textContent = 'üü£ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { purpleHealth -= dmg; purple.style.animation = 'shake 0.2s'; status.textContent = 'üü® ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((yellowX + purpleX) / 2 + 40, (yellowY + purpleY) / 2 + 28);
            purpleVX = -(yellowX - purpleX) / pyDist * 7; purpleVY = -(yellowY - purpleY) / pyDist * 7;
            setTimeout(() => { purple.style.animation = 'losangePulse 1.3s ease-in-out infinite'; yellow.style.animation = ''; }, 200);
        }
        purpleVX *= 0.94; purpleVY *= 0.94;
        
        // Green rectangle AI - balanced fighter, targets nearest
        let gTargetX, gTargetY;
        const gDists = [{d: Math.sqrt((redX+61 - greenX-35)**2 + (redY+49 - greenY-22)**2), x: redX+61, y: redY+49, h: redHealth},
                        {d: Math.sqrt((blueX+40 - greenX-35)**2 + (blueY+40 - greenY-22)**2), x: blueX+40, y: blueY+40, h: blueHealth},
                        {d: Math.sqrt((yellowX+50 - greenX-35)**2 + (yellowY+25 - greenY-22)**2), x: yellowX+50, y: yellowY+25, h: yellowHealth},
                        {d: Math.sqrt((purpleX+30 - greenX-35)**2 + (purpleY+30 - greenY-22)**2), x: purpleX+30, y: purpleY+30, h: purpleHealth}];
        const gNearest = gDists.filter(e => e.h > 0).sort((a,b) => a.d - b.d)[0];
        if (gNearest) { gTargetX = gNearest.x; gTargetY = gNearest.y; }
        else { gTargetX = 400; gTargetY = 300; }
        const dxG = gTargetX - (greenX + 35);
        const dyG = gTargetY - (greenY + 22);
        const distG = Math.sqrt(dxG*dxG + dyG*dyG);
        if (distG > 55) {
            greenVX = (dxG / distG) * 3.8 + (Math.random() - 0.5) * 2;
            greenVY = (dyG / distG) * 3.8 + (Math.random() - 0.5) * 2;
        }
        greenX += greenVX; greenY += greenVY;
        greenX = Math.max(50, Math.min(700, greenX));
        greenY = Math.max(150, Math.min(500, greenY));
        green.style.left = greenX + 'px';
        green.style.top = greenY + 'px';
        
        // Green collisions
        const grDist = Math.sqrt((redX+61 - greenX-35)**2 + (redY+49 - greenY-22)**2);
        if (grDist < 70 && !battleOver && redHealth > 0 && greenHealth > 0) {
            const dmg = Math.floor(Math.random() * 13) + 5;
            if (Math.random() > 0.5) { redHealth -= dmg; red.style.animation = 'shake 0.2s'; status.textContent = 'üü© ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { greenHealth -= dmg; green.style.animation = 'shake 0.2s'; status.textContent = 'üî¥ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((redX + greenX) / 2 + 48, (redY + greenY) / 2 + 35);
            greenVX = -(redX - greenX) / grDist * 6; greenVY = -(redY - greenY) / grDist * 6;
            setTimeout(() => { green.style.animation = 'greenPulse 1.4s ease-in-out infinite'; red.style.animation = ''; }, 200);
        }
        const gbDist = Math.sqrt((blueX+40 - greenX-35)**2 + (blueY+40 - greenY-22)**2);
        if (gbDist < 70 && !battleOver && blueHealth > 0 && greenHealth > 0) {
            const dmg = Math.floor(Math.random() * 13) + 5;
            if (Math.random() > 0.5) { blueHealth -= dmg; blue.style.animation = 'shake 0.2s'; status.textContent = 'üü© ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { greenHealth -= dmg; green.style.animation = 'shake 0.2s'; status.textContent = 'üîµ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((blueX + greenX) / 2 + 38, (blueY + greenY) / 2 + 31);
            greenVX = -(blueX - greenX) / gbDist * 6; greenVY = -(blueY - greenY) / gbDist * 6;
            setTimeout(() => { green.style.animation = 'greenPulse 1.4s ease-in-out infinite'; blue.style.animation = ''; }, 200);
        }
        const gyDist = Math.sqrt((yellowX+50 - greenX-35)**2 + (yellowY+25 - greenY-22)**2);
        if (gyDist < 70 && !battleOver && yellowHealth > 0 && greenHealth > 0) {
            const dmg = Math.floor(Math.random() * 13) + 5;
            if (Math.random() > 0.5) { yellowHealth -= dmg; yellow.style.animation = 'shake 0.2s'; status.textContent = 'üü© ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { greenHealth -= dmg; green.style.animation = 'shake 0.2s'; status.textContent = 'üü® ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((yellowX + greenX) / 2 + 42, (yellowY + greenY) / 2 + 23);
            greenVX = -(yellowX - greenX) / gyDist * 6; greenVY = -(yellowY - greenY) / gyDist * 6;
            setTimeout(() => { green.style.animation = 'greenPulse 1.4s ease-in-out infinite'; yellow.style.animation = ''; }, 200);
        }
        const gpDist = Math.sqrt((purpleX+30 - greenX-35)**2 + (purpleY+30 - greenY-22)**2);
        if (gpDist < 65 && !battleOver && purpleHealth > 0 && greenHealth > 0) {
            const dmg = Math.floor(Math.random() * 13) + 5;
            if (Math.random() > 0.5) { purpleHealth -= dmg; purple.style.animation = 'shake 0.2s'; status.textContent = 'üü© ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            else { greenHealth -= dmg; green.style.animation = 'shake 0.2s'; status.textContent = 'üü£ ' + attacks[Math.floor(Math.random()*attacks.length)] + ' -' + dmg; }
            showImpact((purpleX + greenX) / 2 + 32, (purpleY + greenY) / 2 + 26);
            greenVX = -(purpleX - greenX) / gpDist * 6; greenVY = -(purpleY - greenY) / gpDist * 6;
            setTimeout(() => { green.style.animation = 'greenPulse 1.4s ease-in-out infinite'; purple.style.animation = 'losangePulse 1.3s ease-in-out infinite'; }, 200);
        }
        greenVX *= 0.95; greenVY *= 0.95;
        greenHealthBar.style.width = Math.max(0, greenHealth) + '%';
        if (greenHealth <= 0 && !battleOver) { green.style.opacity = '0.3'; }
        
        // Friction
        redVX *= 0.95;
        redVY *= 0.95;
        blueVX *= 0.95;
        blueVY *= 0.95;
        yellowVX *= 0.95;
        yellowVY *= 0.95;
        
        updatePositions();
    }
    
    setInterval(fight, 50);
})();
</script>
</body>
</html>