<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Twitch Plays Springfield</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            overflow: hidden;
            background: #FFD700;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        #ui h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #FFEB3B;
        }
        #hotbar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
            background: rgba(0,0,0,0.6);
            padding: 8px;
            border-radius: 8px;
            border: 3px solid #555;
        }
        .hotbar-slot {
            width: 50px;
            height: 50px;
            border: 2px solid #888;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .hotbar-slot.selected {
            border-color: #fff;
            box-shadow: 0 0 10px white;
            transform: scale(1.1);
        }
        .hotbar-slot:hover {
            border-color: #aaa;
        }
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 50;
        }
        #crosshair::before, #crosshair::after {
            content: '';
            position: absolute;
            background: white;
            mix-blend-mode: difference;
        }
        #crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
        }
        #crosshair::after {
            width: 20px;
            height: 2px;
            top: 9px;
        }
        #mode-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 8px;
            color: #FFEB3B;
            font-size: 1rem;
            z-index: 100;
        }
        #instruction {
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 8px;
            color: #a0aec0;
            font-size: 0.9rem;
            z-index: 100;
        }
        #instruction code {
            background: rgba(145, 71, 255, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            color: #bf94ff;
        }
    </style>
</head>
<body>
<div id="game-container"></div>
<div id="crosshair"></div>
<div id="ui">
<h1>üç© TWITCH SPRINGFIELD</h1>
<div>Blocks: <span id="block-count">0</span></div>
</div>
<div id="mode-indicator">ü§ñ AUTO-PLAY MODE</div>
<div id="hotbar">
<div class="hotbar-slot selected" data-block="grass" style="background: linear-gradient(to bottom, #7CB342 50%, #8D6E63 50%);">üåø</div>
<div class="hotbar-slot" data-block="dirt" style="background: #8D6E63;">üü´</div>
<div class="hotbar-slot" data-block="stone" style="background: #9E9E9E;">üè†</div>
<div class="hotbar-slot" data-block="wood" style="background: #FFEB3B;">üü®</div>
<div class="hotbar-slot" data-block="diamond" style="background: linear-gradient(135deg, #2196F3, #1976D2);">üîµ</div>
<div class="hotbar-slot" data-block="gold" style="background: linear-gradient(135deg, #FFD700, #FFA000);">‚≠ê</div>
<div class="hotbar-slot" data-block="lava" style="background: linear-gradient(135deg, #76FF03, #4CAF50);">‚ò¢Ô∏è</div>
<div class="hotbar-slot" data-block="donut" style="background: linear-gradient(135deg, #FF69B4, #E91E63);">üç©</div>
</div>
<div id="instruction">Type <code>!idea &lt;your idea&gt;</code> to modify this world!</div>
<script>
        // Minecraft-style voxel game
        const container = document.getElementById('game-container');
        const blockCountEl = document.getElementById('block-count');
        
        // Three.js setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xFFD700);
        scene.fog = new THREE.Fog(0xFFD700, 50, 150);
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(20, 25, 40);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
        sunLight.position.set(50, 100, 50);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);
        
        // Block materials
        const blockMaterials = {
            grass: new THREE.MeshLambertMaterial({ color: 0x7CB342 }),
            dirt: new THREE.MeshLambertMaterial({ color: 0x8D6E63 }),
            stone: new THREE.MeshLambertMaterial({ color: 0x9E9E9E }),
            wood: new THREE.MeshLambertMaterial({ color: 0xFFEB3B }),
            diamond: new THREE.MeshLambertMaterial({ color: 0x2196F3 }),
            gold: new THREE.MeshLambertMaterial({ color: 0xFFD700 }),
            lava: new THREE.MeshLambertMaterial({ color: 0x76FF03, emissive: 0x4CAF50, emissiveIntensity: 0.8 }),
            water: new THREE.MeshLambertMaterial({ color: 0x00BCD4, transparent: true, opacity: 0.7 }),
            pink: new THREE.MeshLambertMaterial({ color: 0xFF69B4 }),
            donut: new THREE.MeshLambertMaterial({ color: 0xE91E63 })
        };
        
        const blockGeometry = new THREE.BoxGeometry(1, 1, 1);
        const blocks = new Map();
        let blockCount = 0;
        
        function getBlockKey(x, y, z) {
            return `${Math.round(x)},${Math.round(y)},${Math.round(z)}`;
        }
        
        function addBlock(x, y, z, type = 'grass') {
            const key = getBlockKey(x, y, z);
            if (blocks.has(key)) return;
            
            const material = blockMaterials[type] || blockMaterials.grass;
            const block = new THREE.Mesh(blockGeometry, material);
            block.position.set(Math.round(x), Math.round(y), Math.round(z));
            block.castShadow = true;
            block.receiveShadow = true;
            block.userData.type = type;
            scene.add(block);
            blocks.set(key, block);
            blockCount++;
            blockCountEl.textContent = blockCount;
        }
        
        function removeBlock(x, y, z) {
            const key = getBlockKey(x, y, z);
            const block = blocks.get(key);
            if (block) {
                scene.remove(block);
                blocks.delete(key);
                blockCount--;
                blockCountEl.textContent = blockCount;
            }
        }
        
        // Generate terrain
        function generateTerrain() {
            const size = 20;
            for (let x = -size; x <= size; x++) {
                for (let z = -size; z <= size; z++) {
                    // Simple height variation
                    const height = Math.floor(Math.sin(x * 0.3) * Math.cos(z * 0.3) * 3) + 2;
                    
                    // Bedrock layer
                    addBlock(x, 0, z, 'stone');
                    
                    // Dirt layers
                    for (let y = 1; y < height; y++) {
                        addBlock(x, y, z, 'dirt');
                    }
                    
                    // Grass top
                    addBlock(x, height, z, 'grass');
                    
                    // Random trees
                    if (Math.random() < 0.02 && height > 2) {
                        for (let ty = 1; ty <= 4; ty++) {
                            addBlock(x, height + ty, z, 'wood');
                        }
                        // Leaves (simplified)
                        for (let lx = -1; lx <= 1; lx++) {
                            for (let lz = -1; lz <= 1; lz++) {
                                addBlock(x + lx, height + 5, z + lz, 'grass');
                            }
                        }
                    }
                    
                    // Random ores
                    if (Math.random() < 0.01) {
                        addBlock(x, 1, z, 'diamond');
                    }
                    if (Math.random() < 0.02) {
                        addBlock(x, 1, z, 'gold');
                    }
                }
            }
            
            // Add the original shapes as special blocks!
            // Purple rectangle -> Amethyst structure
            for (let i = 0; i < 3; i++) {
                addBlock(-5 + i, 6, -5, 'diamond');
                addBlock(-5 + i, 7, -5, 'diamond');
            }
            
            // Blue circle -> Water pool
            for (let x = -8; x <= -6; x++) {
                for (let z = 2; z <= 4; z++) {
                    addBlock(x, 3, z, 'water');
                }
            }
            
            // Red rectangle -> Lava pit
            addBlock(8, 3, 5, 'lava');
            addBlock(9, 3, 5, 'lava');
            addBlock(8, 3, 6, 'lava');
            
            // Yellow diamond -> Gold monument
            addBlock(5, 6, -8, 'gold');
            addBlock(5, 7, -8, 'gold');
            addBlock(5, 8, -8, 'gold');
        }
        
        generateTerrain();
        
        // Build a tower at center!
        function buildTower(baseX, baseZ) {
            const towerHeight = 15;
            const towerWidth = 3;
            
            // Find ground level at this position
            let groundY = 5;
            
            // Tower walls
            for (let y = groundY; y < groundY + towerHeight; y++) {
                for (let x = baseX - 1; x <= baseX + 1; x++) {
                    for (let z = baseZ - 1; z <= baseZ + 1; z++) {
                        // Hollow inside (only walls)
                        if (x === baseX - 1 || x === baseX + 1 || z === baseZ - 1 || z === baseZ + 1) {
                            // Alternate stone and darker stone for texture
                            if (y % 3 === 0) {
                                addBlock(x, y, z, 'stone');
                            } else {
                                addBlock(x, y, z, 'dirt');
                            }
                        }
                    }
                }
                // Corner pillars in wood
                addBlock(baseX - 1, y, baseZ - 1, 'wood');
                addBlock(baseX + 1, y, baseZ - 1, 'wood');
                addBlock(baseX - 1, y, baseZ + 1, 'wood');
                addBlock(baseX + 1, y, baseZ + 1, 'wood');
            }
            
            // Tower top battlements
            const topY = groundY + towerHeight;
            for (let x = baseX - 2; x <= baseX + 2; x++) {
                for (let z = baseZ - 2; z <= baseZ + 2; z++) {
                    addBlock(x, topY, z, 'stone');
                }
            }
            
            // Crenellations (battlements)
            for (let i = -2; i <= 2; i += 2) {
                addBlock(baseX + i, topY + 1, baseZ - 2, 'stone');
                addBlock(baseX + i, topY + 1, baseZ + 2, 'stone');
                addBlock(baseX - 2, topY + 1, baseZ + i, 'stone');
                addBlock(baseX + 2, topY + 1, baseZ + i, 'stone');
            }
            
            // Diamond beacon at the very top!
            addBlock(baseX, topY + 2, baseZ, 'diamond');
            addBlock(baseX, topY + 3, baseZ, 'diamond');
            addBlock(baseX, topY + 4, baseZ, 'gold');
            
            // Window openings (remove some blocks)
            for (let y = groundY + 3; y < groundY + towerHeight - 2; y += 4) {
                removeBlock(baseX, y, baseZ - 1);
                removeBlock(baseX, y, baseZ + 1);
                removeBlock(baseX - 1, y, baseZ);
                removeBlock(baseX + 1, y, baseZ);
            }
        }
        
        // Build the tower at center of the world
        buildTower(0, 0);
        
        // Build Springfield Power Plant cooling towers!
        function buildCoolingTower(baseX, baseZ) {
            for (let y = 5; y < 20; y++) {
                const radius = Math.max(2, 5 - (y - 5) * 0.2);
                for (let angle = 0; angle < Math.PI * 2; angle += 0.3) {
                    const x = baseX + Math.round(Math.cos(angle) * radius);
                    const z = baseZ + Math.round(Math.sin(angle) * radius);
                    addBlock(x, y, z, 'stone');
                }
            }
            // Green radioactive glow at top
            addBlock(baseX, 20, baseZ, 'lava');
            addBlock(baseX+1, 20, baseZ, 'lava');
            addBlock(baseX-1, 20, baseZ, 'lava');
            addBlock(baseX, 20, baseZ+1, 'lava');
            addBlock(baseX, 20, baseZ-1, 'lava');
        }
        buildCoolingTower(-15, -15);
        buildCoolingTower(-15, -10);
        
        // Build Moe's Tavern
        function buildMoesTavern(baseX, baseZ) {
            const groundY = 5;
            // Walls
            for (let y = groundY; y < groundY + 6; y++) {
                for (let x = baseX; x < baseX + 8; x++) {
                    addBlock(x, y, baseZ, 'dirt');
                    addBlock(x, y, baseZ + 5, 'dirt');
                }
                for (let z = baseZ; z < baseZ + 6; z++) {
                    addBlock(baseX, y, z, 'dirt');
                    addBlock(baseX + 7, y, z, 'dirt');
                }
            }
            // Roof
            for (let x = baseX; x < baseX + 8; x++) {
                for (let z = baseZ; z < baseZ + 6; z++) {
                    addBlock(x, groundY + 6, z, 'wood');
                }
            }
            // Neon sign (blue)
            addBlock(baseX + 3, groundY + 7, baseZ, 'diamond');
            addBlock(baseX + 4, groundY + 7, baseZ, 'diamond');
        }
        buildMoesTavern(12, 8);
        
        // Giant Donut (Lard Lad)
        function buildGiantDonut(baseX, baseZ) {
            const centerY = 12;
            const outerR = 5;
            const innerR = 2;
            for (let angle = 0; angle < Math.PI * 2; angle += 0.2) {
                for (let r = innerR; r <= outerR; r += 0.5) {
                    const x = baseX + Math.round(Math.cos(angle) * r);
                    const y = centerY + Math.round(Math.sin(angle) * r * 0.6);
                    addBlock(x, y, baseZ, r > outerR - 1 ? 'donut' : 'wood');
                }
            }
        }
        buildGiantDonut(15, -12);
        
        // Auto-play camera movement
        let autoPlayAngle = 0;
        let autoPlayRadius = 35;
        let autoPlayHeight = 25;
        let targetLookAt = new THREE.Vector3(0, 5, 0);
        
        // Auto-build AI
        let autoBuildTimer = 0;
        const buildTypes = ['grass', 'dirt', 'stone', 'wood', 'diamond', 'gold', 'donut', 'lava'];
        
        function autoPlay(delta) {
            // Smooth camera orbit
            autoPlayAngle += delta * 0.1;
            autoPlayRadius = 35 + Math.sin(autoPlayAngle * 0.5) * 10;
            autoPlayHeight = 25 + Math.sin(autoPlayAngle * 0.3) * 8;
            
            camera.position.x = Math.cos(autoPlayAngle) * autoPlayRadius;
            camera.position.z = Math.sin(autoPlayAngle) * autoPlayRadius;
            camera.position.y = autoPlayHeight;
            camera.lookAt(targetLookAt);
            
            // Auto-build blocks periodically
            autoBuildTimer += delta;
            if (autoBuildTimer > 0.5) {
                autoBuildTimer = 0;
                
                // Random building
                const rx = Math.floor(Math.random() * 10) - 5;
                const rz = Math.floor(Math.random() * 10) - 5;
                const ry = Math.floor(Math.random() * 5) + 5;
                const type = buildTypes[Math.floor(Math.random() * buildTypes.length)];
                
                // 70% chance to build, 30% to remove
                if (Math.random() < 0.7) {
                    addBlock(rx, ry, rz, type);
                } else {
                    removeBlock(rx, ry, rz);
                }
            }
        }
        
        // Hotbar selection
        let selectedBlock = 'grass';
        document.querySelectorAll('.hotbar-slot').forEach(slot => {
            slot.addEventListener('click', () => {
                document.querySelectorAll('.hotbar-slot').forEach(s => s.classList.remove('selected'));
                slot.classList.add('selected');
                selectedBlock = slot.dataset.block;
            });
        });
        
        // Animation loop
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            
            autoPlay(delta);
            
            // Animate lava and water
            blocks.forEach((block, key) => {
                if (block.userData.type === 'lava') {
                    block.position.y += Math.sin(Date.now() * 0.005 + block.position.x) * 0.002;
                }
                if (block.userData.type === 'water') {
                    block.position.y += Math.sin(Date.now() * 0.003 + block.position.z) * 0.001;
                }
            });
            
            renderer.render(scene, camera);
        }
        animate();
        
        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>