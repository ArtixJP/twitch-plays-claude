<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Twitch plays Claude - 3D World</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body { 
        font-family: system-ui, sans-serif; 
        min-height: 100vh; 
        margin: 0;
        background: linear-gradient(180deg, #1a0533 0%, #2d1b4e 20%, #4a2c6a 40%, #6b4d8a 60%, #ff9a56 85%, #ffcf81 100%);
        color: white;
        overflow: hidden;
        perspective: 1200px;
        transform-style: preserve-3d;
    }
    
    .world-container {
        position: absolute;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        animation: worldRotate 60s linear infinite;
    }
    
    @keyframes worldRotate {
        0% { transform: rotateY(0deg); }
        100% { transform: rotateY(360deg); }
    }
    
    .parallax-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
    }
    
    .stars {
        position: absolute;
        width: 100%;
        height: 60%;
        transform: translateZ(-500px) scale(2);
    }
    
    .star {
        position: absolute;
        background: white;
        border-radius: 50%;
        animation: twinkle 2s ease-in-out infinite;
    }
    
    @keyframes twinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.5); }
    }
    
    .floating-island {
        position: absolute;
        bottom: 25%;
        left: 50%;
        transform: translateX(-50%) translateZ(0) rotateX(15deg);
        transform-style: preserve-3d;
        animation: islandFloat 6s ease-in-out infinite;
    }
    
    @keyframes islandFloat {
        0%, 100% { transform: translateX(-50%) translateZ(0) rotateX(15deg) translateY(0); }
        50% { transform: translateX(-50%) translateZ(0) rotateX(15deg) translateY(-15px); }
    }
    
    .island-top {
        width: 400px;
        height: 80px;
        background: linear-gradient(135deg, #4ade80 0%, #22c55e 30%, #16a34a 60%, #15803d 100%);
        border-radius: 50%;
        transform: rotateX(75deg) translateZ(40px);
        box-shadow: 
            0 20px 60px rgba(0,0,0,0.4),
            inset 0 -10px 30px rgba(0,0,0,0.2),
            inset 0 10px 30px rgba(255,255,255,0.3);
    }
    
    .island-bottom {
        position: absolute;
        width: 350px;
        height: 120px;
        background: linear-gradient(180deg, #92400e 0%, #78350f 30%, #451a03 100%);
        border-radius: 0 0 50% 50% / 0 0 100% 100%;
        top: 20px;
        left: 25px;
        transform: rotateX(10deg);
        box-shadow: 0 30px 50px rgba(0,0,0,0.5);
    }
    
    .island-crystal {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 40px solid #a855f7;
        filter: drop-shadow(0 0 20px #a855f7);
        animation: crystalGlow 2s ease-in-out infinite;
    }
    
    @keyframes crystalGlow {
        0%, 100% { filter: drop-shadow(0 0 20px #a855f7); }
        50% { filter: drop-shadow(0 0 40px #e879f9); }
    }
    
    .tree-3d {
        position: absolute;
        transform-style: preserve-3d;
        animation: treeWobble 4s ease-in-out infinite;
    }
    
    @keyframes treeWobble {
        0%, 100% { transform: rotateZ(-2deg); }
        50% { transform: rotateZ(2deg); }
    }
    
    .tree-3d.t1 { bottom: 60px; left: 80px; }
    .tree-3d.t2 { bottom: 55px; right: 100px; transform: scale(0.8); animation-delay: -1s; }
    .tree-3d.t3 { bottom: 50px; left: 180px; transform: scale(0.6); animation-delay: -2s; }
    
    .tree-trunk {
        width: 12px;
        height: 35px;
        background: linear-gradient(90deg, #451a03, #78350f, #451a03);
        border-radius: 3px;
        margin: 0 auto;
    }
    
    .tree-foliage {
        width: 0;
        height: 0;
        border-left: 25px solid transparent;
        border-right: 25px solid transparent;
        border-bottom: 50px solid #22c55e;
        position: relative;
        left: -19px;
        filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
    }
    
    .tree-foliage::before {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-bottom: 40px solid #16a34a;
        top: 15px;
        left: -20px;
    }
    
    .cloud-3d {
        position: absolute;
        transform-style: preserve-3d;
        animation: cloudDrift 30s linear infinite;
    }
    
    .cloud-3d.c1 { top: 15%; left: -100px; transform: translateZ(-100px); animation-duration: 35s; }
    .cloud-3d.c2 { top: 25%; left: -150px; transform: translateZ(-200px) scale(1.5); animation-duration: 45s; animation-delay: -15s; }
    .cloud-3d.c3 { top: 10%; left: -80px; transform: translateZ(50px) scale(0.7); animation-duration: 25s; animation-delay: -8s; }
    
    @keyframes cloudDrift {
        0% { left: -150px; }
        100% { left: 110%; }
    }
    
    .cloud-puff {
        position: absolute;
        background: rgba(255,255,255,0.9);
        border-radius: 50%;
        box-shadow: 
            inset -10px -10px 20px rgba(0,0,0,0.1),
            inset 10px 10px 20px rgba(255,255,255,0.8),
            0 10px 30px rgba(0,0,0,0.1);
    }
    
    .cloud-puff:nth-child(1) { width: 60px; height: 50px; left: 0; top: 10px; }
    .cloud-puff:nth-child(2) { width: 80px; height: 60px; left: 40px; top: 0; }
    .cloud-puff:nth-child(3) { width: 50px; height: 45px; left: 100px; top: 15px; }
    
    .sun-3d {
        position: absolute;
        top: 10%;
        right: 15%;
        width: 100px;
        height: 100px;
        transform: translateZ(100px);
        transform-style: preserve-3d;
    }
    
    .sun-core {
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, #fff9c4 0%, #ffeb3b 30%, #ffc107 60%, #ff9800 100%);
        border-radius: 50%;
        box-shadow: 
            0 0 80px 30px rgba(255, 235, 59, 0.6),
            0 0 120px 50px rgba(255, 193, 7, 0.4),
            0 0 180px 80px rgba(255, 152, 0, 0.2);
        animation: sunPulse3d 4s ease-in-out infinite;
    }
    
    @keyframes sunPulse3d {
        0%, 100% { transform: scale(1) rotateY(0deg); }
        50% { transform: scale(1.1) rotateY(180deg); }
    }
    
    .content-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding-top: 5%;
        transform: translateZ(50px);
    }
    
    h1 { 
        font-size: 2.5rem; 
        text-align: center; 
        margin-bottom: 0.5rem;
        text-shadow: 
            0 0 20px rgba(168, 85, 247, 0.8),
            0 4px 8px rgba(0,0,0,0.5),
            0 0 60px rgba(168, 85, 247, 0.4);
        animation: titleFloat 3s ease-in-out infinite;
        background: linear-gradient(135deg, #fff 0%, #e9d5ff 50%, #c084fc 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    @keyframes titleFloat {
        0%, 100% { transform: translateY(0) rotateX(0deg); }
        50% { transform: translateY(-8px) rotateX(5deg); }
    }
    
    .instruction {
        text-align: center;
        font-size: 1rem;
        color: rgba(255,255,255,0.9);
        max-width: 500px;
        margin: 0 auto;
        padding: 15px 25px;
        line-height: 1.5;
        background: rgba(0,0,0,0.3);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    .instruction code {
        background: rgba(168, 85, 247, 0.4);
        padding: 2px 8px;
        border-radius: 4px;
        color: #e9d5ff;
    }
    
    .dance-platform {
        position: absolute;
        bottom: 28%;
        left: 50%;
        transform: translateX(-50%) translateZ(30px) rotateX(60deg);
        width: 300px;
        height: 60px;
        background: linear-gradient(135deg, rgba(168,85,247,0.6) 0%, rgba(139,92,246,0.4) 100%);
        border-radius: 50%;
        box-shadow: 
            0 0 40px rgba(168,85,247,0.5),
            inset 0 0 30px rgba(255,255,255,0.2);
        animation: platformPulse 2s ease-in-out infinite;
    }
    
    @keyframes platformPulse {
        0%, 100% { box-shadow: 0 0 40px rgba(168,85,247,0.5), inset 0 0 30px rgba(255,255,255,0.2); }
        50% { box-shadow: 0 0 60px rgba(168,85,247,0.8), inset 0 0 40px rgba(255,255,255,0.3); }
    }
    
    .dance-crowd {
        position: absolute;
        bottom: 32%;
        left: 50%;
        transform: translateX(-50%) translateZ(40px);
        display: flex;
        justify-content: center;
        gap: 8px;
        z-index: 10;
    }
    
    .dancer {
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: bounce3d 0.5s ease-in-out infinite, dancerSway3d 2s ease-in-out infinite;
        transform-style: preserve-3d;
    }
    
    @keyframes bounce3d {
        0%, 100% { transform: translateY(0) translateZ(0); }
        50% { transform: translateY(-12px) translateZ(10px); }
    }
    
    @keyframes dancerSway3d {
        0%, 100% { transform: rotateY(-25deg) rotateZ(-5deg); }
        50% { transform: rotateY(25deg) rotateZ(5deg); }
    }
    
    .dancer:nth-child(2) { animation-delay: 0.1s; }
    .dancer:nth-child(3) { animation-delay: 0.2s; }
    .dancer:nth-child(4) { animation-delay: 0.15s; }
    .dancer:nth-child(5) { animation-delay: 0.25s; }
    .dancer:nth-child(6) { animation-delay: 0.05s; }
    .dancer:nth-child(7) { animation-delay: 0.3s; }
    
    .dancer-head {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-bottom: 3px;
        box-shadow: 
            3px 3px 8px rgba(0,0,0,0.4), 
            inset -3px -3px 6px rgba(0,0,0,0.2), 
            inset 3px 3px 6px rgba(255,255,255,0.4),
            0 0 15px currentColor;
    }
    
    .dancer-body {
        width: 18px;
        height: 25px;
        border-radius: 8px 8px 4px 4px;
        box-shadow: 
            4px 4px 12px rgba(0,0,0,0.4), 
            inset -4px -4px 8px rgba(0,0,0,0.2), 
            inset 4px 4px 8px rgba(255,255,255,0.3),
            0 0 20px currentColor;
    }
    
    .dancer-arms {
        width: 35px;
        height: 4px;
        margin-top: -20px;
        border-radius: 2px;
        animation: armWave3d 0.5s ease-in-out infinite alternate;
    }
    
    @keyframes armWave3d {
        0% { transform: rotateZ(-20deg) rotateX(10deg); }
        100% { transform: rotateZ(20deg) rotateX(-10deg); }
    }
    
    .dancer-legs {
        display: flex;
        gap: 5px;
        margin-top: 18px;
    }
    
    .dancer-leg {
        width: 4px;
        height: 18px;
        border-radius: 2px;
    }
    
    .dancer.pink .dancer-head, .dancer.pink .dancer-body { background: linear-gradient(135deg, #ff8fb3 0%, #ff6b9d 40%, #e5527f 100%); color: #ff6b9d; }
    .dancer.pink .dancer-arms, .dancer.pink .dancer-leg { background: linear-gradient(180deg, #ff8fb3, #e5527f); }
    
    .dancer.blue .dancer-head, .dancer.blue .dancer-body { background: linear-gradient(135deg, #7fd4fb 0%, #4fc3f7 40%, #29a8e0 100%); color: #4fc3f7; }
    .dancer.blue .dancer-arms, .dancer.blue .dancer-leg { background: linear-gradient(180deg, #7fd4fb, #29a8e0); }
    
    .dancer.yellow .dancer-head, .dancer.yellow .dancer-body { background: linear-gradient(135deg, #ffe082 0%, #ffd54f 40%, #e6b800 100%); color: #ffd54f; }
    .dancer.yellow .dancer-arms, .dancer.yellow .dancer-leg { background: linear-gradient(180deg, #ffe082, #e6b800); }
    
    .dancer.green .dancer-head, .dancer.green .dancer-body { background: linear-gradient(135deg, #a5d6a7 0%, #81c784 40%, #5cb85c 100%); color: #81c784; }
    .dancer.green .dancer-arms, .dancer.green .dancer-leg { background: linear-gradient(180deg, #a5d6a7, #5cb85c); }
    
    .dancer.purple .dancer-head, .dancer.purple .dancer-body { background: linear-gradient(135deg, #ce93d8 0%, #ba68c8 40%, #9c4dcc 100%); color: #ba68c8; }
    .dancer.purple .dancer-arms, .dancer.purple .dancer-leg { background: linear-gradient(180deg, #ce93d8, #9c4dcc); }
    
    .dancer.orange .dancer-head, .dancer.orange .dancer-body { background: linear-gradient(135deg, #ffcc80 0%, #ffb74d 40%, #f5a623 100%); color: #ffb74d; }
    .dancer.orange .dancer-arms, .dancer.orange .dancer-leg { background: linear-gradient(180deg, #ffcc80, #f5a623); }
    
    .dancer.cyan .dancer-head, .dancer.cyan .dancer-body { background: linear-gradient(135deg, #80deea 0%, #4dd0e1 40%, #26c6da 100%); color: #4dd0e1; }
    .dancer.cyan .dancer-arms, .dancer.cyan .dancer-leg { background: linear-gradient(180deg, #80deea, #26c6da); }
    
    .floating-orb {
        position: absolute;
        border-radius: 50%;
        animation: orbFloat 8s ease-in-out infinite;
        box-shadow: 0 0 30px currentColor;
    }
    
    .orb1 { width: 20px; height: 20px; background: #a855f7; top: 30%; left: 10%; animation-delay: 0s; color: #a855f7; }
    .orb2 { width: 15px; height: 15px; background: #38bdf8; top: 45%; right: 12%; animation-delay: -2s; color: #38bdf8; }
    .orb3 { width: 25px; height: 25px; background: #fb7185; top: 20%; left: 25%; animation-delay: -4s; color: #fb7185; }
    .orb4 { width: 12px; height: 12px; background: #4ade80; top: 55%; left: 8%; animation-delay: -6s; color: #4ade80; }
    
    @keyframes orbFloat {
        0%, 100% { transform: translateY(0) translateZ(0) scale(1); opacity: 0.8; }
        25% { transform: translateY(-30px) translateZ(50px) scale(1.2); opacity: 1; }
        50% { transform: translateY(-10px) translateZ(100px) scale(1); opacity: 0.9; }
        75% { transform: translateY(-40px) translateZ(30px) scale(1.1); opacity: 1; }
    }
    
    .snake-arcade {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) translateZ(80px);
        background: linear-gradient(145deg, #1a0533 0%, #2d1b4e 50%, #4a2c6a 100%);
        border: 3px solid #a855f7;
        border-radius: 15px;
        padding: 10px;
        box-shadow: 
            0 0 30px rgba(168, 85, 247, 0.6),
            0 0 60px rgba(168, 85, 247, 0.3),
            inset 0 0 20px rgba(168, 85, 247, 0.2);
        animation: arcadeFloat 4s ease-in-out infinite;
        z-index: 100;
    }
    
    @keyframes arcadeFloat {
        0%, 100% { transform: translate(-50%, -50%) translateZ(80px) rotateY(-5deg); }
        50% { transform: translate(-50%, -50%) translateZ(100px) rotateY(5deg); }
    }
    
    .snake-title {
        text-align: center;
        color: #e9d5ff;
        font-size: 0.9rem;
        margin-bottom: 5px;
        text-shadow: 0 0 10px #a855f7;
    }
    
    .snake-canvas {
        background: #0a0a0a;
        border: 2px solid #6b21a8;
        border-radius: 5px;
        display: block;
    }
    
    .snake-score {
        text-align: center;
        color: #4ade80;
        font-size: 0.8rem;
        margin-top: 5px;
        text-shadow: 0 0 8px #4ade80;
    }
    
    .snake-instructions {
        text-align: center;
        color: rgba(255,255,255,0.6);
        font-size: 0.6rem;
        margin-top: 3px;
    }
    
    .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: white;
        border-radius: 50%;
        animation: particleRise 6s linear infinite;
        opacity: 0;
    }
    
    @keyframes particleRise {
        0% { transform: translateY(0) translateZ(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-200px) translateZ(50px); opacity: 0; }
    }
</style>
</head>
<body>
<div class="stars">
<div class="star" style="width:2px;height:2px;top:10%;left:15%;animation-delay:0s;"></div>
<div class="star" style="width:3px;height:3px;top:5%;left:45%;animation-delay:0.5s;"></div>
<div class="star" style="width:2px;height:2px;top:15%;left:70%;animation-delay:1s;"></div>
<div class="star" style="width:4px;height:4px;top:8%;left:85%;animation-delay:1.5s;"></div>
<div class="star" style="width:2px;height:2px;top:20%;left:30%;animation-delay:0.3s;"></div>
<div class="star" style="width:3px;height:3px;top:12%;left:55%;animation-delay:0.8s;"></div>
<div class="star" style="width:2px;height:2px;top:3%;left:25%;animation-delay:1.2s;"></div>
<div class="star" style="width:3px;height:3px;top:18%;left:90%;animation-delay:0.6s;"></div>
</div>
<div class="sun-3d">
<div class="sun-core"></div>
</div>
<div class="cloud-3d c1">
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
</div>
<div class="cloud-3d c2">
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
</div>
<div class="cloud-3d c3">
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
<div class="cloud-puff"></div>
</div>
<div class="floating-orb orb1"></div>
<div class="floating-orb orb2"></div>
<div class="floating-orb orb3"></div>
<div class="floating-orb orb4"></div>
<div class="content-layer">
<h1>‚ú® 3D World ‚ú®</h1>
<p class="instruction">
        Type <code>!idea &lt;your idea&gt;</code> in the Twitch chat to shape this world.<br/>
        Example: <code>!idea Add a dragon flying around</code>
</p>
</div>
<div class="floating-island">
<div class="island-crystal"></div>
<div class="tree-3d t1">
<div class="tree-foliage"></div>
<div class="tree-trunk"></div>
</div>
<div class="tree-3d t2">
<div class="tree-foliage"></div>
<div class="tree-trunk"></div>
</div>
<div class="tree-3d t3">
<div class="tree-foliage"></div>
<div class="tree-trunk"></div>
</div>
<div class="island-top"></div>
<div class="island-bottom"></div>
</div>
<div class="dance-platform"></div>
<div class="dance-crowd">
<div class="dancer pink">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer blue">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer yellow">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer green">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer purple">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer orange">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
<div class="dancer cyan">
<div class="dancer-head"></div>
<div class="dancer-body"></div>
<div class="dancer-arms"></div>
<div class="dancer-legs"><div class="dancer-leg"></div><div class="dancer-leg"></div></div>
</div>
</div>
<div class="snake-arcade">
<div class="snake-title">üêç Magic Snake üêç</div>
<canvas class="snake-canvas" height="150" id="snakeGame" width="200"></canvas>
<div class="snake-score">Score: <span id="snakeScore">0</span></div>
<div class="snake-instructions">Arrow keys to play | Space to restart</div>
</div>
<script>
(function() {
    const canvas = document.getElementById('snakeGame');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('snakeScore');
    
    const gridSize = 10;
    const tileCount = { x: canvas.width / gridSize, y: canvas.height / gridSize };
    
    let snake = [{ x: 10, y: 7 }];
    let food = { x: 15, y: 7 };
    let dx = 1, dy = 0;
    let score = 0;
    let gameLoop;
    let gameOver = false;
    
    function spawnFood() {
        food = {
            x: Math.floor(Math.random() * tileCount.x),
            y: Math.floor(Math.random() * tileCount.y)
        };
    }
    
    function draw() {
        // Clear with gradient
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, '#0a0a15');
        gradient.addColorStop(1, '#1a0a25');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw food with glow
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#ff6b9d';
        ctx.fillStyle = '#ff6b9d';
        ctx.beginPath();
        ctx.arc(food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2, gridSize/2 - 1, 0, Math.PI * 2);
        ctx.fill();
        
        // Draw snake with glow
        ctx.shadowColor = '#4ade80';
        snake.forEach((segment, i) => {
            const brightness = 1 - (i / snake.length) * 0.5;
            ctx.fillStyle = `rgba(74, 222, 128, ${brightness})`;
            ctx.shadowBlur = i === 0 ? 20 : 10;
            ctx.beginPath();
            ctx.roundRect(segment.x * gridSize + 1, segment.y * gridSize + 1, gridSize - 2, gridSize - 2, 3);
            ctx.fill();
        });
        ctx.shadowBlur = 0;
        
        if (gameOver) {
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#e9d5ff';
            ctx.font = '14px system-ui';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over!', canvas.width/2, canvas.height/2 - 10);
            ctx.font = '10px system-ui';
            ctx.fillText('Press Space', canvas.width/2, canvas.height/2 + 10);
        }
    }
    
    function update() {
        if (gameOver) return;
        
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };
        
        // Wrap around
        if (head.x < 0) head.x = tileCount.x - 1;
        if (head.x >= tileCount.x) head.x = 0;
        if (head.y < 0) head.y = tileCount.y - 1;
        if (head.y >= tileCount.y) head.y = 0;
        
        // Self collision
        if (snake.some(s => s.x === head.x && s.y === head.y)) {
            gameOver = true;
            return;
        }
        
        snake.unshift(head);
        
        if (head.x === food.x && head.y === food.y) {
            score += 10;
            scoreEl.textContent = score;
            spawnFood();
        } else {
            snake.pop();
        }
    }
    
    function gameStep() {
        update();
        draw();
    }
    
    function resetGame() {
        snake = [{ x: 10, y: 7 }];
        dx = 1; dy = 0;
        score = 0;
        scoreEl.textContent = 0;
        gameOver = false;
        spawnFood();
    }
    
    document.addEventListener('keydown', (e) => {
        if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
            e.preventDefault();
        }
        
        if (e.key === ' ' && gameOver) {
            resetGame();
            return;
        }
        
        if (e.key === 'ArrowUp' && dy !== 1) { dx = 0; dy = -1; }
        if (e.key === 'ArrowDown' && dy !== -1) { dx = 0; dy = 1; }
        if (e.key === 'ArrowLeft' && dx !== 1) { dx = -1; dy = 0; }
        if (e.key === 'ArrowRight' && dx !== -1) { dx = 1; dy = 0; }
    });
    
    gameLoop = setInterval(gameStep, 120);
    draw();
})();
</script>
<div class="particle" style="left:20%;bottom:30%;animation-delay:0s;"></div>
<div class="particle" style="left:40%;bottom:28%;animation-delay:1s;"></div>
<div class="particle" style="left:60%;bottom:32%;animation-delay:2s;"></div>
<div class="particle" style="left:75%;bottom:29%;animation-delay:3s;"></div>
<div class="particle" style="left:35%;bottom:35%;animation-delay:4s;"></div>
<div class="particle" style="left:55%;bottom:31%;animation-delay:5s;"></div>
</body>
</html>