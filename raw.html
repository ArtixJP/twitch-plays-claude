<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Twitch plays Claude</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.min.js"></script>
<style>
        body { 
            font-family: system-ui, sans-serif; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow: hidden;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            cursor: crosshair;
        }
        .content {
            position: relative;
            z-index: 1;
            pointer-events: none;
        }
        .click-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(145, 71, 255, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #bf94ff;
            z-index: 2;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
        }
        h1 { font-size: 3rem; text-align: center; margin-bottom: 1rem; }
        .instruction {
            text-align: center;
            font-size: 1.2rem;
            color: #a0aec0;
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
            line-height: 1.6;
        }
        .instruction code {
            background: rgba(145, 71, 255, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            color: #bf94ff;
        }
    </style>
</head>
<body>
<div id="canvas-container"></div>
<div class="content">
<h1>Hello World!</h1>
<p class="instruction">
        Type <code>!idea &lt;your idea&gt;</code> in the Twitch chat to add to this page.<br/>
        Example: <code>!idea Add a space cat floating in the background</code>
</p>
</div>
<div class="click-hint">ðŸŽ± Click anywhere to drop balls!</div>
<script>
        // Three.js Scene Setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 25);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(10, 20, 10);
        directionalLight.castShadow = true;
        scene.add(directionalLight);
        const pointLight = new THREE.PointLight(0xbf94ff, 1, 50);
        pointLight.position.set(0, 10, 0);
        scene.add(pointLight);

        // Cannon.js Physics World
        const world = new CANNON.World();
        world.gravity.set(0, -20, 0);
        world.broadphase = new CANNON.NaiveBroadphase();

        // Ground
        const groundBody = new CANNON.Body({ mass: 0, shape: new CANNON.Plane() });
        groundBody.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
        groundBody.position.y = -5;
        world.addBody(groundBody);

        const groundGeo = new THREE.PlaneGeometry(100, 100);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x1a1a2e, transparent: true, opacity: 0.5 });
        const groundMesh = new THREE.Mesh(groundGeo, groundMat);
        groundMesh.rotation.x = -Math.PI / 2;
        groundMesh.position.y = -5;
        groundMesh.receiveShadow = true;
        scene.add(groundMesh);

        // Ball tracking
        const balls = [];
        const colors = [0xff6b6b, 0x4ecdc4, 0xffe66d, 0x95e1d3, 0xf38181, 0xaa96da, 0xfcbad3, 0xa8d8ea];

        function createBall(x, y) {
            const radius = 0.5 + Math.random() * 0.5;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Three.js mesh
            const geometry = new THREE.SphereGeometry(radius, 32, 32);
            const material = new THREE.MeshStandardMaterial({ 
                color: color, 
                metalness: 0.3, 
                roughness: 0.4,
                emissive: color,
                emissiveIntensity: 0.1
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.castShadow = true;
            
            // Convert screen coords to 3D
            const vector = new THREE.Vector3(
                (x / window.innerWidth) * 2 - 1,
                -(y / window.innerHeight) * 2 + 1,
                0.5
            );
            vector.unproject(camera);
            const dir = vector.sub(camera.position).normalize();
            const distance = 15;
            const pos = camera.position.clone().add(dir.multiplyScalar(distance));
            pos.y = 15;
            
            mesh.position.copy(pos);
            scene.add(mesh);

            // Cannon.js body
            const body = new CANNON.Body({
                mass: radius * 2,
                shape: new CANNON.Sphere(radius),
                position: new CANNON.Vec3(pos.x, pos.y, pos.z)
            });
            body.velocity.set((Math.random() - 0.5) * 5, 0, (Math.random() - 0.5) * 5);
            world.addBody(body);

            balls.push({ mesh, body, life: 600 });
        }

        // Click handler
        container.addEventListener('click', (e) => {
            for(let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createBall(
                        e.clientX + (Math.random() - 0.5) * 100,
                        e.clientY + (Math.random() - 0.5) * 50
                    );
                }, i * 50);
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            world.step(1/60);

            for(let i = balls.length - 1; i >= 0; i--) {
                const ball = balls[i];
                ball.mesh.position.copy(ball.body.position);
                ball.mesh.quaternion.copy(ball.body.quaternion);
                ball.life--;
                
                if(ball.life <= 0 || ball.body.position.y < -10) {
                    scene.remove(ball.mesh);
                    world.removeBody(ball.body);
                    balls.splice(i, 1);
                }
            }
            renderer.render(scene, camera);
        }
        animate();

        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>