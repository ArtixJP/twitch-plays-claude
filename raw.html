<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>üé® The Living Canvas - Create Together! ‚ú®</title>
<style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
        }
        
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .main-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            animation: floatIn 1s ease-out;
        }
        
        @keyframes floatIn {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 25%, #ffd700 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 5s ease infinite;
            text-shadow: 0 0 30px rgba(240, 147, 251, 0.5);
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .subtitle {
            color: #a78bfa;
            font-size: 1.2rem;
            margin-top: 10px;
            opacity: 0.9;
        }
        
        .canvas-area {
            position: relative;
            width: 700px;
            height: 450px;
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            border-radius: 20px;
            border: 3px solid rgba(167, 139, 250, 0.4);
            box-shadow: 
                0 0 40px rgba(147, 51, 234, 0.3),
                inset 0 0 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: canvasPulse 4s ease-in-out infinite;
        }
        
        @keyframes canvasPulse {
            0%, 100% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.3), inset 0 0 60px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 0 60px rgba(147, 51, 234, 0.5), 0 0 100px rgba(79, 172, 254, 0.2), inset 0 0 60px rgba(0,0,0,0.3); }
        }
        
        #creation-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        .toolbar {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            padding: 15px 25px;
            background: rgba(0,0,0,0.4);
            border-radius: 50px;
            border: 2px solid rgba(167, 139, 250, 0.3);
            animation: slideUp 0.8s ease-out 0.3s both;
        }
        
        @keyframes slideUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .tool-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tool-btn:hover {
            transform: scale(1.15);
            background: rgba(167, 139, 250, 0.3);
            border-color: #a78bfa;
            box-shadow: 0 0 20px rgba(167, 139, 250, 0.5);
        }
        
        .tool-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #ffd700;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.6);
        }
        
        .stats-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.9), rgba(79, 70, 229, 0.85));
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid #a78bfa;
            box-shadow: 0 0 30px rgba(147, 51, 234, 0.4);
            z-index: 100;
            animation: slideInRight 0.6s ease-out;
        }
        
        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(50px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        .stats-panel h3 {
            color: #fbbf24;
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item {
            color: #fff;
            font-size: 0.9rem;
            margin: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-value {
            color: #76FF03;
            font-weight: 600;
        }
        
        .chat-panel {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 220px;
            max-height: 350px;
            background: linear-gradient(180deg, rgba(0,0,0,0.85), rgba(30,0,60,0.8));
            border: 2px solid #bf94ff;
            border-radius: 15px;
            padding: 15px;
            z-index: 100;
            overflow-y: auto;
            animation: slideInLeft 0.6s ease-out;
        }
        
        @keyframes slideInLeft {
            0% { opacity: 0; transform: translate(-50px, -50%); }
            100% { opacity: 1; transform: translate(0, -50%); }
        }
        
        .chat-panel h3 {
            color: #bf94ff;
            font-size: 1rem;
            text-align: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(191, 148, 255, 0.3);
        }
        
        .chat-messages {
            font-size: 0.8rem;
        }
        
        .chat-msg {
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 8px;
            margin: 5px 0;
            word-wrap: break-word;
        }
        
        .chat-msg .username {
            color: #a78bfa;
            font-weight: 600;
        }
        
        .chat-msg .message {
            color: #ddd;
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 12px 25px;
            border-radius: 25px;
            border: 2px solid rgba(167, 139, 250, 0.4);
            z-index: 100;
            animation: fadeInUp 0.8s ease-out 0.5s both;
        }
        
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            100% { opacity: 1; transform: translate(-50%, 0); }
        }
        
        .instructions p {
            color: #a0aec0;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .instructions code {
            background: rgba(145, 71, 255, 0.3);
            padding: 3px 8px;
            border-radius: 5px;
            color: #bf94ff;
            font-family: monospace;
        }
        
        .floating-emoji {
            position: fixed;
            font-size: 2rem;
            animation: floatAround 20s linear infinite;
            opacity: 0.6;
            pointer-events: none;
            z-index: 5;
        }
        
        @keyframes floatAround {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(100px, -50px) rotate(90deg); }
            50% { transform: translate(50px, 100px) rotate(180deg); }
            75% { transform: translate(-50px, 50px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }
        
        .creation-counter {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 10px 25px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 0 30px rgba(240, 147, 251, 0.5);
            animation: pulseGlow 2s ease-in-out infinite;
            z-index: 100;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(240, 147, 251, 0.5); }
            50% { box-shadow: 0 0 50px rgba(240, 147, 251, 0.8), 0 0 80px rgba(245, 87, 108, 0.4); }
        }
        
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(147, 51, 234, 0.95) 0%, rgba(15, 12, 41, 0.98) 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: welcomeFade 4s ease forwards;
        }
        
        @keyframes welcomeFade {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }
        
        .welcome-content {
            text-align: center;
            animation: welcomePop 0.8s ease-out;
        }
        
        @keyframes welcomePop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .welcome-emoji {
            font-size: 5rem;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .welcome-title {
            font-size: 3rem;
            color: white;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
        }
        
        .welcome-sub {
            color: #fbbf24;
            font-size: 1.3rem;
        }
    </style>
</head>
<body>

<canvas id="particle-canvas"></canvas>

<div class="welcome-overlay" id="welcome">
<div class="welcome-content">
<div class="welcome-emoji">üé®‚ú®üåü</div>
<h1 class="welcome-title">Welcome to The Living Canvas!</h1>
<p class="welcome-sub">Where creativity flows together</p>
</div>
</div>

<div class="floating-emoji" style="top: 10%; left: 5%;">üé®</div>
<div class="floating-emoji" style="top: 70%; left: 8%; animation-delay: -5s;">‚ú®</div>
<div class="floating-emoji" style="top: 30%; right: 5%; animation-delay: -10s;">üåà</div>
<div class="floating-emoji" style="top: 80%; right: 8%; animation-delay: -15s;">üí´</div>

<div class="creation-counter">
        ‚ú® Creations: <span id="creation-count">0</span> | Collaborators: <span id="collab-count">‚àû</span>
</div>

<div class="stats-panel">
<h3>üìä Canvas Stats</h3>
<div class="stat-item">üé® Strokes: <span class="stat-value" id="stroke-count">0</span></div>
<div class="stat-item">üåà Colors Used: <span class="stat-value" id="color-count">0</span></div>
<div class="stat-item">‚≠ê Stars Added: <span class="stat-value" id="star-count">0</span></div>
<div class="stat-item">üí¨ Chat Commands: <span class="stat-value" id="cmd-count">0</span></div>
</div>

<div class="chat-panel">
<h3>üí¨ Live Chat</h3>
<div class="chat-messages" id="chat-messages">
<div class="chat-msg">
<span class="username">System:</span>
<span class="message">Welcome! Type commands to create together!</span>
</div>
</div>
</div>

<div class="main-container">
<div class="header">
<h1 class="title">üé® The Living Canvas ‚ú®</h1>
<p class="subtitle">Create something interesting together!</p>
</div>
<div class="canvas-area">
<canvas id="creation-canvas"></canvas>
</div>
<div class="toolbar">
<button class="tool-btn active" data-tool="brush" title="Brush">üñåÔ∏è</button>
<button class="tool-btn" data-tool="star" title="Add Stars">‚≠ê</button>
<button class="tool-btn" data-tool="heart" title="Add Hearts">üíñ</button>
<button class="tool-btn" data-tool="sparkle" title="Sparkles">‚ú®</button>
<button class="tool-btn" data-tool="rainbow" title="Rainbow Mode">üåà</button>
<button class="tool-btn" data-tool="clear" title="Clear Canvas">üóëÔ∏è</button>
</div>
</div>

<div class="instructions">
<p>üí¨ Chat commands: <code>star</code> <code>heart</code> <code>sparkle</code> <code>rainbow</code> <code>clear</code> | Click &amp; drag to draw!</p>
</div>
<script>
        // Remove welcome after animation
        setTimeout(() => {
            const welcome = document.getElementById('welcome');
            if (welcome) welcome.remove();
        }, 4500);
        
        // Particle Background
        const particleCanvas = document.getElementById('particle-canvas');
        const pCtx = particleCanvas.getContext('2d');
        particleCanvas.width = window.innerWidth;
        particleCanvas.height = window.innerHeight;
        
        const particles = [];
        const particleCount = 80;
        
        class Particle {
            constructor() {
                this.reset();
            }
            
            reset() {
                this.x = Math.random() * particleCanvas.width;
                this.y = Math.random() * particleCanvas.height;
                this.size = Math.random() * 3 + 1;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random() * 0.5 + 0.2;
                this.hue = Math.random() * 60 + 250; // Purple-pink range
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                if (this.x < 0 || this.x > particleCanvas.width ||
                    this.y < 0 || this.y > particleCanvas.height) {
                    this.reset();
                }
            }
            
            draw() {
                pCtx.beginPath();
                pCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                pCtx.fillStyle = `hsla(${this.hue}, 80%, 60%, ${this.opacity})`;
                pCtx.fill();
            }
        }
        
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
        
        function animateParticles() {
            pCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();
        
        // Creation Canvas
        const canvas = document.getElementById('creation-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 700;
        canvas.height = 450;
        
        let isDrawing = false;
        let currentTool = 'brush';
        let hue = 0;
        let strokeCount = 0;
        let starCount = 0;
        let colorSet = new Set();
        let cmdCount = 0;
        
        // Auto-draw demonstration
        let autoDrawing = true;
        let autoAngle = 0;
        let autoCenterX = canvas.width / 2;
        let autoCenterY = canvas.height / 2;
        let autoRadius = 100;
        
        function autoDraw() {
            if (!autoDrawing) return;
            
            autoAngle += 0.05;
            const x = autoCenterX + Math.cos(autoAngle) * autoRadius * Math.sin(autoAngle * 0.3);
            const y = autoCenterY + Math.sin(autoAngle) * autoRadius * Math.cos(autoAngle * 0.5);
            
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, Math.PI * 2);
            ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
            ctx.fill();
            
            hue = (hue + 1) % 360;
            colorSet.add(Math.floor(hue / 30));
            
            // Add occasional sparkles
            if (Math.random() < 0.05) {
                addSparkle(x, y);
            }
            
            strokeCount++;
            updateStats();
            
            setTimeout(autoDraw, 50);
        }
        
        function addSparkle(x, y) {
            const sparkles = ['‚ú®', '‚≠ê', 'üí´', 'üåü'];
            ctx.font = '20px Arial';
            ctx.fillText(sparkles[Math.floor(Math.random() * sparkles.length)], x - 10, y + 10);
            starCount++;
        }
        
        function addStar(x, y) {
            ctx.font = '30px Arial';
            ctx.fillText('‚≠ê', x - 15, y + 15);
            starCount++;
            updateStats();
        }
        
        function addHeart(x, y) {
            ctx.font = '30px Arial';
            ctx.fillText('üíñ', x - 15, y + 15);
            updateStats();
        }
        
        function addRainbow(x, y) {
            const colors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3'];
            colors.forEach((color, i) => {
                ctx.beginPath();
                ctx.arc(x, y + 30, 40 - i * 5, Math.PI, 0, false);
                ctx.strokeStyle = color;
                ctx.lineWidth = 4;
                ctx.stroke();
            });
            updateStats();
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            strokeCount = 0;
            starCount = 0;
            colorSet.clear();
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('stroke-count').textContent = strokeCount;
            document.getElementById('color-count').textContent = colorSet.size;
            document.getElementById('star-count').textContent = starCount;
            document.getElementById('cmd-count').textContent = cmdCount;
            document.getElementById('creation-count').textContent = strokeCount + starCount;
        }
        
        // Tool buttons
        document.querySelectorAll('.tool-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTool = btn.dataset.tool;
                autoDrawing = false;
                
                if (currentTool === 'clear') {
                    clearCanvas();
                }
            });
        });
        
        // Mouse drawing
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            autoDrawing = false;
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (currentTool === 'brush' || currentTool === 'rainbow') {
                ctx.beginPath();
                ctx.arc(x, y, currentTool === 'rainbow' ? 8 : 5, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                ctx.fill();
                hue = (hue + 3) % 360;
                colorSet.add(Math.floor(hue / 30));
                strokeCount++;
            } else if (currentTool === 'star') {
                if (Math.random() < 0.1) addStar(x, y);
            } else if (currentTool === 'heart') {
                if (Math.random() < 0.1) addHeart(x, y);
            } else if (currentTool === 'sparkle') {
                if (Math.random() < 0.15) addSparkle(x, y);
            }
            
            updateStats();
        });
        
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseleave', () => isDrawing = false);
        
        // Chat integration
        function processCommand(cmd, username) {
            const command = cmd.toLowerCase().trim();
            const cx = Math.random() * canvas.width * 0.8 + canvas.width * 0.1;
            const cy = Math.random() * canvas.height * 0.8 + canvas.height * 0.1;
            
            if (command === 'star') {
                addStar(cx, cy);
                cmdCount++;
            } else if (command === 'heart') {
                addHeart(cx, cy);
                cmdCount++;
            } else if (command === 'sparkle') {
                addSparkle(cx, cy);
                cmdCount++;
            } else if (command === 'rainbow') {
                addRainbow(cx, cy);
                cmdCount++;
            } else if (command === 'clear') {
                clearCanvas();
                cmdCount++;
            }
            
            updateStats();
        }
        
        function renderChat() {
            const container = document.getElementById('chat-messages');
            if (!container || !window.tpc || !window.tpc.chatMessages) return;
            
            const messages = window.tpc.chatMessages.slice(-10);
            container.innerHTML = messages.map(m => {
                const isCmd = /^(star|heart|sparkle|rainbow|clear)$/i.test(m.message.trim());
                return `<div class="chat-msg" style="${isCmd ? 'border-left: 3px solid #76FF03;' : ''}">
                    <span class="username">${m.username}:</span>
                    <span class="message" style="${isCmd ? 'color: #76FF03; font-weight: bold;' : ''}">${m.message}</span>
                </div>`;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }
        
        function initChatControl() {
            if (typeof window.tpc === 'undefined') {
                setTimeout(initChatControl, 500);
                return;
            }
            
            window.tpc.onChatMessage = function(msg) {
                processCommand(msg.message, msg.username);
                renderChat();
            };
            
            let lastIdx = window.tpc.chatMessages?.length || 0;
            setInterval(() => {
                if (!window.tpc?.chatMessages) return;
                if (window.tpc.chatMessages.length > lastIdx) {
                    for (let i = lastIdx; i < window.tpc.chatMessages.length; i++) {
                        processCommand(window.tpc.chatMessages[i].message, window.tpc.chatMessages[i].username);
                    }
                    lastIdx = window.tpc.chatMessages.length;
                    renderChat();
                }
            }, 100);
            
            renderChat();
        }
        
        initChatControl();
        
        // Start auto-drawing after welcome
        setTimeout(autoDraw, 4500);
        
        // Window resize
        window.addEventListener('resize', () => {
            particleCanvas.width = window.innerWidth;
            particleCanvas.height = window.innerHeight;
        });
    </script>
</body>
</html>